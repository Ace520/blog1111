<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>jenssegers/laravel-mongodb MongoDB 数据库的支持 | ACE-BLOG</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="alternate" type="application/rss+xml" href="https://ace520.github.io/blog/rss.xml" title="ACE-BLOG RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://ace520.github.io/blog/feed.atom" title="ACE-BLOG Atom Feed">
    <link rel="alternate" type="application/json" href="https://ace520.github.io/blog/feed.json" title="ACE-BLOG JSON Feed">
    <meta name="description" content="Ace blog">
    <link rel="preload" href="/blog/assets/css/0.styles.66708137.css" as="style"><link rel="preload" href="/blog/assets/js/app.8b9b2d3a.js" as="script"><link rel="preload" href="/blog/assets/js/4.156a5de0.js" as="script"><link rel="preload" href="/blog/assets/js/21.c3e0a280.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.871112d0.js"><link rel="prefetch" href="/blog/assets/js/11.d5a5c916.js"><link rel="prefetch" href="/blog/assets/js/12.7532389c.js"><link rel="prefetch" href="/blog/assets/js/13.5dead4ad.js"><link rel="prefetch" href="/blog/assets/js/14.4665ada1.js"><link rel="prefetch" href="/blog/assets/js/15.dd41ba14.js"><link rel="prefetch" href="/blog/assets/js/16.f12e2f00.js"><link rel="prefetch" href="/blog/assets/js/17.416c2e5a.js"><link rel="prefetch" href="/blog/assets/js/18.d40d5e31.js"><link rel="prefetch" href="/blog/assets/js/19.148c4b72.js"><link rel="prefetch" href="/blog/assets/js/20.19149ca6.js"><link rel="prefetch" href="/blog/assets/js/22.26393986.js"><link rel="prefetch" href="/blog/assets/js/23.2ee23272.js"><link rel="prefetch" href="/blog/assets/js/24.c19637ee.js"><link rel="prefetch" href="/blog/assets/js/25.73029a55.js"><link rel="prefetch" href="/blog/assets/js/26.8b89427b.js"><link rel="prefetch" href="/blog/assets/js/27.9ae3a2a4.js"><link rel="prefetch" href="/blog/assets/js/28.2afcd143.js"><link rel="prefetch" href="/blog/assets/js/3.3d7a0512.js"><link rel="prefetch" href="/blog/assets/js/5.20424f17.js"><link rel="prefetch" href="/blog/assets/js/6.e700dcec.js"><link rel="prefetch" href="/blog/assets/js/7.506bcbdf.js"><link rel="prefetch" href="/blog/assets/js/8.8e8b6157.js"><link rel="prefetch" href="/blog/assets/js/9.ad5ac6db.js"><link rel="prefetch" href="/blog/assets/js/vuejs-paginate.675e43f5.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.66708137.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="global-layout" class="flex flex-column"><div class="jumbotron" style="background:url(https://raw.githubusercontent.com/Ace520/blog/master/static/laravel.jpg);background-size:cover;background-position:center;"><header class="header flex-none"><div class="container mx-auto h-full flex items-center justify-between"><div class="flex items-center"><a href="/blog/" class="title router-link-active">ACE-BLOG</a> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="nav"><a href="/blog/post/" class="nav-active">博文</a><a href="/blog/archive">归档</a><a href="/blog/category">分类</a><a href="/blog/about">关于</a></div></div></header> <div class="jumbotron-dark"></div> <!----></div> <div class="flex-1 main-content container mx-auto"><div class="container-p" data-v-a51a10f0><h2 data-v-a51a10f0>jenssegers/laravel-mongodb MongoDB 数据库的支持</h2> <div class="post-footer" data-v-a51a10f0><a href="/blog/tag/laravel" class="tag-item item" data-v-a51a10f0>laravel</a><a href="/blog/tag/数据库" class="tag-item item" data-v-a51a10f0>数据库</a><a href="/blog/tag/MongoDB" class="tag-item item" data-v-a51a10f0>MongoDB</a> <span class="item span" data-v-a51a10f0>/</span> <a href="/blog/topic/Composer 扩展包" class="link item" data-v-a51a10f0>Composer 扩展包</a> <span class="item span" data-v-a51a10f0>/</span> <div class="item date" data-v-a51a10f0>2020-05-22T00:00:00.000Z</div></div> <div class="article" data-v-a51a10f0><div class="content__default" data-v-a51a10f0><h1 id="https-github-com-jenssegers-laravel-mongodblaravel-mongodb"><a href="https://github.com/jenssegers/laravel-mongodb" target="_blank" rel="noopener noreferrer">https://github.com/jenssegers/laravel-mongodb<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
Laravel MongoDB</h1> <p><a href="https://packagist.org/packages/jenssegers/mongodb" target="_blank" rel="noopener noreferrer"><img src="http://img.shields.io/github/release/jenssegers/laravel-mongodb.svg" alt="Latest Stable Version"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://packagist.org/packages/jenssegers/mongodb" target="_blank" rel="noopener noreferrer"><img src="http://img.shields.io/packagist/dm/jenssegers/mongodb.svg" alt="Total Downloads"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://github.com/jenssegers/laravel-mongodb/actions" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/github/workflow/status/jenssegers/laravel-mongodb/CI" alt="Build Status"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://codecov.io/gh/jenssegers/laravel-mongodb/branch/master" target="_blank" rel="noopener noreferrer"><img src="https://codecov.io/gh/jenssegers/laravel-mongodb/branch/master/graph/badge.svg" alt="codecov"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://www.paypal.me/jenssegers" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/donate-paypal-blue.svg" alt="Donate"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>This package adds functionalities to the Eloquent model and Query builder for MongoDB, using the original Laravel API. <em>This library extends the original Laravel classes, so it uses exactly the same methods.</em></p> <ul><li><a href="#laravel-mongodb">Laravel MongoDB</a> <ul><li><a href="#installation">Installation</a> <ul><li><a href="#laravel-version-compatibility">Laravel version Compatibility</a></li> <li><a href="#laravel">Laravel</a></li> <li><a href="#lumen">Lumen</a></li> <li><a href="#non-laravel-projects">Non-Laravel projects</a></li></ul></li> <li><a href="#testing">Testing</a></li> <li><a href="#database-testing">Database Testing</a></li> <li><a href="#configuration">Configuration</a></li> <li><a href="#eloquent">Eloquent</a> <ul><li><a href="#extending-the-base-model">Extending the base model</a></li> <li><a href="#soft-deletes">Soft Deletes</a></li> <li><a href="#dates">Dates</a></li> <li><a href="#basic-usage">Basic Usage</a></li> <li><a href="#mongodb-specific-operators">MongoDB-specific operators</a></li> <li><a href="#mongodb-specific-geo-operations">MongoDB-specific Geo operations</a></li> <li><a href="#inserts-updates-and-deletes">Inserts, updates and deletes</a></li> <li><a href="#mongodb-specific-operations">MongoDB specific operations</a></li></ul></li> <li><a href="#relationships">Relationships</a> <ul><li><a href="#basic-usage-1">Basic Usage</a></li> <li><a href="#belongstomany-and-pivots">belongsToMany and pivots</a></li> <li><a href="#embedsmany-relationship">EmbedsMany Relationship</a></li> <li><a href="#embedsone-relationship">EmbedsOne Relationship</a></li></ul></li> <li><a href="#query-builder">Query Builder</a> <ul><li><a href="#basic-usage-2">Basic Usage</a></li> <li><a href="#available-operations">Available operations</a></li></ul></li> <li><a href="#schema">Schema</a> <ul><li><a href="#basic-usage-3">Basic Usage</a></li> <li><a href="#geospatial-indexes">Geospatial indexes</a></li></ul></li> <li><a href="#extending">Extending</a> <ul><li><a href="#cross-database-relationships">Cross-Database Relationships</a></li> <li><a href="#authentication">Authentication</a></li> <li><a href="#queues">Queues</a> <ul><li><a href="#laravel-specific">Laravel specific</a></li> <li><a href="#Lumen-specific">Lumen specific</a></li></ul></li></ul></li> <li><a href="#upgrading">Upgrading</a> <ul><li><a href="#upgrading-from-version-2-to-3">Upgrading from version 2 to 3</a></li></ul></li></ul></li></ul> <h2 id="installation">Installation</h2> <p>Make sure you have the MongoDB PHP driver installed. You can find installation instructions at http://php.net/manual/en/mongodb.installation.php</p> <h3 id="laravel-version-compatibility">Laravel version Compatibility</h3> <table><thead><tr><th style="text-align:left;">Laravel</th> <th style="text-align:left;">Package</th></tr></thead> <tbody><tr><td style="text-align:left;">4.2.x</td> <td style="text-align:left;">2.0.x</td></tr> <tr><td style="text-align:left;">5.0.x</td> <td style="text-align:left;">2.1.x</td></tr> <tr><td style="text-align:left;">5.1.x</td> <td style="text-align:left;">2.2.x or 3.0.x</td></tr> <tr><td style="text-align:left;">5.2.x</td> <td style="text-align:left;">2.3.x or 3.0.x</td></tr> <tr><td style="text-align:left;">5.3.x</td> <td style="text-align:left;">3.1.x or 3.2.x</td></tr> <tr><td style="text-align:left;">5.4.x</td> <td style="text-align:left;">3.2.x</td></tr> <tr><td style="text-align:left;">5.5.x</td> <td style="text-align:left;">3.3.x</td></tr> <tr><td style="text-align:left;">5.6.x</td> <td style="text-align:left;">3.4.x</td></tr> <tr><td style="text-align:left;">5.7.x</td> <td style="text-align:left;">3.4.x</td></tr> <tr><td style="text-align:left;">5.8.x</td> <td style="text-align:left;">3.5.x</td></tr> <tr><td style="text-align:left;">6.x</td> <td style="text-align:left;">3.6.x</td></tr></tbody></table> <p>Install the package via Composer:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ composer require jenssegers/mongodb
</code></pre></div><h3 id="laravel">Laravel</h3> <p>In case your Laravel version does NOT autoload the packages, add the service provider to <code>config/app.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>Jenssegers\<span class="token package">Mongodb<span class="token punctuation">\</span>MongodbServiceProvider</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="lumen">Lumen</h3> <p>For usage with <a href="http://lumen.laravel.com" target="_blank" rel="noopener noreferrer">Lumen<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, add the service provider in <code>bootstrap/app.php</code>. In this file, you will also need to enable Eloquent. You must however ensure that your call to <code>$app-&gt;withEloquent();</code> is <strong>below</strong> where you have registered the <code>MongodbServiceProvider</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$app</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">register</span><span class="token punctuation">(</span>Jenssegers\<span class="token package">Mongodb<span class="token punctuation">\</span>MongodbServiceProvider</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$app</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">withEloquent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The service provider will register a MongoDB database extension with the original database manager. There is no need to register additional facades or objects.</p> <p>When using MongoDB connections, Laravel will automatically provide you with the corresponding MongoDB objects.</p> <h3 id="non-laravel-projects">Non-Laravel projects</h3> <p>For usage outside Laravel, check out the <a href="https://github.com/illuminate/database/blob/master/README.md" target="_blank" rel="noopener noreferrer">Capsule manager<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and add:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$capsule</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getDatabaseManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'mongodb'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$config</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Connection</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="testing">Testing</h2> <p>To run the test for this package, run:</p> <div class="language- extra-class"><pre class="language-text"><code>docker-compose up
</code></pre></div><h2 id="database-testing">Database Testing</h2> <p>To reset the database after each test, add:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>DatabaseMigrations</span><span class="token punctuation">;</span>
</code></pre></div><p>Also inside each test classes, add:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">DatabaseMigrations</span><span class="token punctuation">;</span>
</code></pre></div><p>Keep in mind that these traits are not yet supported:</p> <ul><li><code>use Database Transactions;</code></li> <li><code>use RefreshDatabase;</code></li></ul> <h2 id="configuration">Configuration</h2> <p>You can use MongoDB either as the main database, either as a side database. To do so, add a new <code>mongodb</code> connection to <code>config/database.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'mongodb'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'driver'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'mongodb'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'host'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'DB_HOST'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'127.0.0.1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'port'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'DB_PORT'</span><span class="token punctuation">,</span> <span class="token number">27017</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'database'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'DB_DATABASE'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'homestead'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'username'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'DB_USERNAME'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'homestead'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'password'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'DB_PASSWORD'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'secret'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'options'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token comment">// here you can pass more settings to the Mongo Driver Manager</span>
        <span class="token comment">// see https://www.php.net/manual/en/mongodb-driver-manager.construct.php under &quot;Uri Options&quot; for a list of complete parameters that you can use</span>

        <span class="token single-quoted-string string">'database'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'DB_AUTHENTICATION_DATABASE'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// required with Mongo 3+</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>For multiple servers or replica set configurations, set the host to an array and specify each server host:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'mongodb'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'driver'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'mongodb'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'host'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'server1'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'server2'</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token single-quoted-string string">'options'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'replicaSet'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'rs0'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>If you wish to use a connection string instead of full key-value params, you can set it so. Check the documentation on MongoDB's URI format: https://docs.mongodb.com/manual/reference/connection-string/</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'mongodb'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'driver'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'mongodb'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'dsn'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'DB_DSN'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'database'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'DB_DATABASE'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'homestead'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="eloquent">Eloquent</h2> <h3 id="extending-the-base-model">Extending the base model</h3> <p>This package includes a MongoDB enabled Eloquent class that you can use to define models for corresponding collections.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Just like a normal model, the MongoDB model class will know which collection to use based on the model name. For <code>Book</code>, the collection <code>books</code> will be used.</p> <p>To change the collection, pass the <code>$collection</code> property:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$collection</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'my_books_collection'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>NOTE:</strong> MongoDB documents are automatically stored with a unique ID that is stored in the <code>_id</code> property. If you wish to use your own ID, substitute the <code>$primaryKey</code> property and set it to your own primary key attribute name.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$primaryKey</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'id'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Mongo will also create _id, but the 'id' property will be used for primary key actions like find().</span>
Book<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'title'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'The Fault in Our Stars'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Likewise, you may define a <code>connection</code> property to override the name of the database connection that should be used when utilizing the model.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'mongodb'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="soft-deletes">Soft Deletes</h3> <p>When soft deleting a model, it is not actually removed from your database. Instead, a deleted_at timestamp is set on the record.</p> <p>To enable soft deletes for a model, apply the <code>Jenssegers\Mongodb\Eloquent\SoftDeletes</code> Trait to the model:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>SoftDeletes</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">SoftDeletes</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token variable">$dates</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'deleted_at'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For more information check <a href="http://laravel.com/docs/eloquent#soft-deleting" target="_blank" rel="noopener noreferrer">Laravel Docs about Soft Deleting<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h3 id="dates">Dates</h3> <p>Eloquent allows you to work with Carbon or DateTime objects instead of MongoDate objects. Internally, these dates will be converted to MongoDate objects when saved to the database.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$dates</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'birthday'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This allows you to execute queries like this:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span>
    <span class="token single-quoted-string string">'birthday'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'&gt;'</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">DateTime</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'-18 years'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="basic-usage">Basic Usage</h3> <p><strong>Retrieving all models</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Retrieving a record by primary key</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'517c43667db388101e00000f'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Where</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$posts</span> <span class="token operator">=</span>
    Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'author.name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'John'</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>OR Statements</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$posts</span> <span class="token operator">=</span>
    Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'votes'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">orWhere</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'is_approved'</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>AND statements</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span>
    User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'age'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'!='</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'John'</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>whereIn</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">whereIn</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'age'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When using <code>whereNotIn</code> objects will be returned if the field is non-existent. Combine with <code>whereNotNull('age')</code> to leave out those documents.</p> <p><strong>whereBetween</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$posts</span> <span class="token operator">=</span> Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">whereBetween</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'votes'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>whereNull</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">whereNull</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'age'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Advanced wheres</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span>
    User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'John'</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">orWhere</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$query</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'votes'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'&gt;'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'title'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'&lt;&gt;'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>orderBy</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'age'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'desc'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Offset &amp; Limit (skip &amp; take)</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span>
    User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>groupBy</strong></p> <p>Selected columns that are not grouped will be aggregated with the <code>$last</code> function.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span>
    Users<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'title'</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'title'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Distinct</strong></p> <p>Distinct requires a field for which to return the distinct values.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Equivalent to:</span>
<span class="token variable">$users</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Distinct can be combined with <strong>where</strong>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span>
    User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'active'</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Like</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$spamComments</span> <span class="token operator">=</span> Comment<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'body'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'like'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'%spam%'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Aggregation</strong></p> <p><strong>Aggregations are only available for MongoDB versions greater than 2.2.x</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$total</span> <span class="token operator">=</span> Product<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$price</span> <span class="token operator">=</span> Product<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$price</span> <span class="token operator">=</span> Product<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$price</span> <span class="token operator">=</span> Product<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">avg</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$total</span> <span class="token operator">=</span> Product<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Aggregations can be combined with <strong>where</strong>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$sold</span> <span class="token operator">=</span> Orders<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'sold'</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Aggregations can be also used on sub-documents:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$total</span> <span class="token operator">=</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'suborder.price'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>NOTE</strong>: This aggregation only works with single sub-documents (like <code>EmbedsOne</code>) not subdocument arrays (like <code>EmbedsMany</code>).</p> <p><strong>Incrementing/Decrementing the value of a column</strong></p> <p>Perform increments or decrements (default 1) on specified attributes:</p> <div class="language-php extra-class"><pre class="language-php"><code>Cat<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Kitty'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Car<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Toyota'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'weight'</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The number of updated objects is returned:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$count</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You may also specify additional columns to update:</p> <div class="language-php extra-class"><pre class="language-php"><code>Cat<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'age'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'age'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'group'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Kitty Club'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Car<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'weight'</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'weight'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'latest_change'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'carbon fiber'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="mongodb-specific-operators">MongoDB-specific operators</h3> <p><strong>Exists</strong></p> <p>Matches documents that have the specified field.</p> <div class="language-php extra-class"><pre class="language-php"><code>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'age'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'exists'</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>All</strong></p> <p>Matches arrays that contain all elements specified in the query.</p> <div class="language-php extra-class"><pre class="language-php"><code>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'roles'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'all'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'moderator'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'author'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Size</strong></p> <p>Selects documents if the array field is a specified size.</p> <div class="language-php extra-class"><pre class="language-php"><code>Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'tags'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'size'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Regex</strong></p> <p>Selects documents where values match a specified regular expression.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">MongoDB<span class="token punctuation">\</span>BSON<span class="token punctuation">\</span>Regex</span><span class="token punctuation">;</span>

User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'regex'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Regex</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'.*doe'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'i'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>NOTE:</strong> you can also use the Laravel regexp operations. These are a bit more flexible and will automatically convert your regular expression string to a <code>MongoDB\BSON\Regex</code> object.</p> <div class="language-php extra-class"><pre class="language-php"><code>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'regexp'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'/.*doe/i'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The inverse of regexp:</p> <div class="language-php extra-class"><pre class="language-php"><code>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'not regexp'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'/.*doe/i'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Type</strong></p> <p>Selects documents if a field is of the specified type. For more information check: http://docs.mongodb.org/manual/reference/operator/query/type/#op._S_type</p> <div class="language-php extra-class"><pre class="language-php"><code>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'age'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'type'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Mod</strong></p> <p>Performs a modulo operation on the value of a field and selects documents with a specified result.</p> <div class="language-php extra-class"><pre class="language-php"><code>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'age'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'mod'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="mongodb-specific-geo-operations">MongoDB-specific Geo operations</h3> <p><strong>Near</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$bars</span> <span class="token operator">=</span> Bar<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'location'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'near'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'$geometry'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'type'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Point'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'coordinates'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
            <span class="token operator">-</span><span class="token number">0.1367563</span><span class="token punctuation">,</span> <span class="token comment">// longitude</span>
            <span class="token number">51.5100913</span><span class="token punctuation">,</span> <span class="token comment">// latitude</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'$maxDistance'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">50</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>GeoWithin</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$bars</span> <span class="token operator">=</span> Bar<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'location'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'geoWithin'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'$geometry'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'type'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Polygon'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'coordinates'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
            <span class="token punctuation">[</span>
                <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.1450383</span><span class="token punctuation">,</span> <span class="token number">51.5069158</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.1367563</span><span class="token punctuation">,</span> <span class="token number">51.5100913</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.1270247</span><span class="token punctuation">,</span> <span class="token number">51.5013233</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.1450383</span><span class="token punctuation">,</span> <span class="token number">51.5069158</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>GeoIntersects</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$bars</span> <span class="token operator">=</span> Bar<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'location'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'geoIntersects'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'$geometry'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'type'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'LineString'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'coordinates'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
            <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.144044</span><span class="token punctuation">,</span> <span class="token number">51.515215</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.129545</span><span class="token punctuation">,</span> <span class="token number">51.507864</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="inserts-updates-and-deletes">Inserts, updates and deletes</h3> <p>Inserting, updating and deleting records works just like the original Eloquent. Please check <a href="https://laravel.com/docs/6.x/eloquent" target="_blank" rel="noopener noreferrer">Laravel Docs' Eloquent section<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Here, only the MongoDB-specific operations are specified.</p> <h3 id="mongodb-specific-operations">MongoDB specific operations</h3> <p><strong>Raw Expressions</strong></p> <p>These expressions will be injected directly into the query.</p> <div class="language-php extra-class"><pre class="language-php"><code>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">whereRaw</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'age'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'$gt'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'$lt'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also perform raw expressions on the internal MongoCollection object. If this is executed on the model class, it will return a collection of models.</p> <p>If this is executed on the query builder, it will return the original response.</p> <p><strong>Cursor timeout</strong></p> <p>To prevent <code>MongoCursorTimeout</code> exceptions, you can manually set a timeout value that will be applied to the cursor:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Upsert</strong></p> <p>Update or insert a document. Additional options for the update method are passed directly to the native update method.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Query Builder</span>
<span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'John'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'upsert'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean constant">true</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Eloquent</span>
<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'upsert'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean constant">true</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Projections</strong></p> <p>You can apply projections to your queries using the <code>project</code> method.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'items'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">project</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'tags'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'$slice'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'items'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">project</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'tags'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'$slice'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Projections with Pagination</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$limit</span> <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
<span class="token variable">$projections</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'id'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'items'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">paginate</span><span class="token punctuation">(</span><span class="token variable">$limit</span><span class="token punctuation">,</span> <span class="token variable">$projections</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Push</strong></p> <p>Add items to an array.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'John'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'items'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'boots'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'items'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'boots'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'John'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'messages'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'from'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Jane Doe'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'message'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Hi John'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'messages'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'from'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Jane Doe'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'message'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Hi John'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you <strong>DON'T</strong> want duplicate items, set the third parameter to <code>true</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'John'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'items'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'boots'</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'items'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'boots'</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Pull</strong></p> <p>Remove an item from an array.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'John'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'items'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'boots'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'items'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'boots'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'John'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'messages'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'from'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Jane Doe'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'message'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Hi John'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'messages'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'from'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Jane Doe'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'message'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Hi John'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Unset</strong></p> <p>Remove one or more fields from a document.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'John'</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'note'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'note'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="relationships">Relationships</h2> <h3 id="basic-usage-2">Basic Usage</h3> <p>The only available relationships are:</p> <ul><li>hasOne</li> <li>hasMany</li> <li>belongsTo</li> <li>belongsToMany</li></ul> <p>The MongoDB-specific relationships are:</p> <ul><li>embedsOne</li> <li>embedsMany</li></ul> <p>Here is a small example:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">items</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasMany</span><span class="token punctuation">(</span>Item<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The inverse relation of <code>hasMany</code> is <code>belongsTo</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Item</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="belongstomany-and-pivots">belongsToMany and pivots</h3> <p>The belongsToMany relation will not use a pivot &quot;table&quot; but will push id's to a <strong>related_ids</strong> attribute instead. This makes the second parameter for the belongsToMany method useless.</p> <p>If you want to define custom keys for your relation, set it to <code>null</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsToMany</span><span class="token punctuation">(</span>
            Group<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'user_ids'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'group_ids'</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="embedsmany-relationship">EmbedsMany Relationship</h3> <p>If you want to embed models, rather than referencing them, you can use the <code>embedsMany</code> relation. This relation is similar to the <code>hasMany</code> relation but embeds the models inside the parent object.</p> <p><strong>REMEMBER</strong>: These relations return Eloquent collections, they don't return query builder objects!</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">embedsMany</span><span class="token punctuation">(</span>Book<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can access the embedded models through the dynamic property:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">books</span> <span class="token keyword">as</span> <span class="token variable">$book</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The inverse relation is auto<em>magically</em> available. You don't need to define this reverse relation.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$book</span> <span class="token operator">=</span> Book<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$book</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user</span><span class="token punctuation">;</span>
</code></pre></div><p>Inserting and updating embedded models works similar to the <code>hasMany</code> relation:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$book</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'title'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'A Game of Thrones'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// or</span>
<span class="token variable">$book</span> <span class="token operator">=</span>
    <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'title'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'A Game of Thrones'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can update embedded models using their <code>save</code> method (available since release 2.0.0):</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$book</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$book</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">title</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'A Game of Thrones'</span><span class="token punctuation">;</span>
<span class="token variable">$book</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can remove an embedded model by using the <code>destroy</code> method on the relation, or the <code>delete</code> method on the model (available since release 2.0.0):</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$book</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Similar operation</span>
<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token variable">$book</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you want to add or remove an embedded model, without touching the database, you can use the <code>associate</code> and <code>dissociate</code> methods.</p> <p>To eventually write the changes to the database, save the parent object:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">associate</span><span class="token punctuation">(</span><span class="token variable">$book</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Like other relations, embedsMany assumes the local key of the relationship based on the model name. You can override the default local key by passing a second argument to the embedsMany method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">embedsMany</span><span class="token punctuation">(</span>Book<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'local_key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Embedded relations will return a Collection of embedded items instead of a query builder. Check out the available operations here: https://laravel.com/docs/master/collections</p> <h3 id="embedsone-relationship">EmbedsOne Relationship</h3> <p>The embedsOne relation is similar to the embedsMany relation, but only embeds a single model.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">author</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">embedsOne</span><span class="token punctuation">(</span>Author<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You can access the embedded models through the dynamic property:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$book</span> <span class="token operator">=</span> Book<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$author</span> <span class="token operator">=</span> <span class="token variable">$book</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">author</span><span class="token punctuation">;</span>
</code></pre></div><p>Inserting and updating embedded models works similar to the <code>hasOne</code> relation:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$author</span> <span class="token operator">=</span> <span class="token variable">$book</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">Author</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'John Doe'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Similar</span>
<span class="token variable">$author</span> <span class="token operator">=</span>
    <span class="token variable">$book</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'John Doe'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can update the embedded model using the <code>save</code> method (available since release 2.0.0):</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$author</span> <span class="token operator">=</span> <span class="token variable">$book</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">author</span><span class="token punctuation">;</span>

<span class="token variable">$author</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'Jane Doe'</span><span class="token punctuation">;</span>
<span class="token variable">$author</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can replace the embedded model with a new model like this:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$newAuthor</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Author</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Jane Doe'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$book</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$newAuthor</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="query-builder">Query Builder</h2> <h3 id="basic-usage-3">Basic Usage</h3> <p>The database driver plugs right into the original query builder.</p> <p>When using MongoDB connections, you will be able to build fluent queries to perform database operations.</p> <p>For your convenience, there is a <code>collection</code> alias for <code>table</code> as well as some additional MongoDB specific operators/operations.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$books</span> <span class="token operator">=</span> <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'books'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$hungerGames</span> <span class="token operator">=</span>
    <span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'books'</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Hunger Games'</span><span class="token punctuation">)</span>
        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If you are familiar with <a href="http://laravel.com/docs/queries" target="_blank" rel="noopener noreferrer">Eloquent Queries<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, there is the same functionality.</p> <h3 id="available-operations">Available operations</h3> <p>To see the available operations, check the <a href="#eloquent">Eloquent</a> section.</p> <h2 id="schema">Schema</h2> <p>The database driver also has (limited) schema builder support. You can easily manipulate collections and set indexes.</p> <h3 id="basic-usage-4">Basic Usage</h3> <div class="language-php extra-class"><pre class="language-php"><code>Schema<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$collection</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$collection</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$collection</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'email'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also pass all the parameters specified <a href="https://docs.mongodb.com/manual/reference/method/db.collection.createIndex/#options-for-all-index-types" target="_blank" rel="noopener noreferrer">in the MongoDB docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to the <code>$options</code> parameter:</p> <div class="language-php extra-class"><pre class="language-php"><code>Schema<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$collection</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$collection</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">index</span><span class="token punctuation">(</span>
        <span class="token single-quoted-string string">'username'</span><span class="token punctuation">,</span>
        <span class="token constant">null</span><span class="token punctuation">,</span>
        <span class="token constant">null</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
            <span class="token single-quoted-string string">'sparse'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean constant">true</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'unique'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean constant">true</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'background'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean constant">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Inherited operations:</p> <ul><li>create and drop</li> <li>collection</li> <li>hasCollection</li> <li>index and dropIndex (compound indexes supported as well)</li> <li>unique</li></ul> <p>MongoDB specific operations:</p> <ul><li>background</li> <li>sparse</li> <li>expire</li> <li>geospatial</li></ul> <p>All other (unsupported) operations are implemented as dummy pass-through methods because MongoDB does not use a predefined schema.</p> <p>Read more about the schema builder on <a href="https://laravel.com/docs/6.0/migrations#tables" target="_blank" rel="noopener noreferrer">Laravel Docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="geospatial-indexes">Geospatial indexes</h3> <p>Geospatial indexes are handy for querying location-based documents.</p> <p>They come in two forms: <code>2d</code> and <code>2dsphere</code>. Use the schema builder to add these to a collection.</p> <div class="language-php extra-class"><pre class="language-php"><code>Schema<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'bars'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$collection</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$collection</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">geospatial</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'location'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>To add a <code>2dsphere</code> index:</p> <div class="language-php extra-class"><pre class="language-php"><code>Schema<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'bars'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$collection</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$collection</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">geospatial</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'location'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'2dsphere'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="extending">Extending</h2> <h3 id="cross-database-relationships">Cross-Database Relationships</h3> <p>If you're using a hybrid MongoDB and SQL setup, you can define relationships across them.</p> <p>The model will automatically return a MongoDB-related or SQL-related relation based on the type of the related model.</p> <p>If you want this functionality to work both ways, your SQL-models will need to use the <code>Jenssegers\Mongodb\Eloquent\HybridRelations</code> trait.</p> <p><strong>This functionality only works for <code>hasOne</code>, <code>hasMany</code> and <code>belongsTo</code>.</strong></p> <p>The MySQL model should use the <code>HybridRelations</code> trait:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>HybridRelations</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">HybridRelations</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'mysql'</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">messages</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasMany</span><span class="token punctuation">(</span>Message<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Within your MongoDB model, you should define the relationship:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Message</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'mongodb'</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">belongsTo</span><span class="token punctuation">(</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="authentication">Authentication</h3> <p>If you want to use Laravel's native Auth functionality, register this included service provider:</p> <div class="language-php extra-class"><pre class="language-php"><code>Jenssegers\<span class="token package">Mongodb<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>PasswordResetServiceProvider</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
</code></pre></div><p>This service provider will slightly modify the internal DatabaseReminderRepository to add support for MongoDB based password reminders.</p> <p>If you don't use password reminders, you don't have to register this service provider and everything else should work just fine.</p> <h3 id="queues">Queues</h3> <p>If you want to use MongoDB as your database backend, change the driver in <code>config/queue.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'connections'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'database'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'driver'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'mongodb'</span><span class="token punctuation">,</span>
        <span class="token comment">// You can also specify your jobs specific database created on config/database.php</span>
        <span class="token single-quoted-string string">'connection'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'mongodb-job'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'table'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'jobs'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'queue'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'default'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'expire'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">60</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>If you want to use MongoDB to handle failed jobs, change the database in <code>config/queue.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'failed'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'driver'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'mongodb'</span><span class="token punctuation">,</span>
    <span class="token comment">// You can also specify your jobs specific database created on config/database.php</span>
    <span class="token single-quoted-string string">'database'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'mongodb-job'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'table'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'failed_jobs'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="laravel-specific">Laravel specific</h4> <p>Add the service provider in <code>config/app.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>Jenssegers\<span class="token package">Mongodb<span class="token punctuation">\</span>MongodbQueueServiceProvider</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="lumen-specific">Lumen specific</h4> <p>With <a href="http://lumen.laravel.com" target="_blank" rel="noopener noreferrer">Lumen<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, add the service provider in <code>bootstrap/app.php</code>. You must however ensure that you add the following <strong>after</strong> the <code>MongodbServiceProvider</code> registration.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$app</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'queue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$app</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">register</span><span class="token punctuation">(</span>Jenssegers\<span class="token package">Mongodb<span class="token punctuation">\</span>MongodbQueueServiceProvider</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="upgrading">Upgrading</h2> <h4 id="upgrading-from-version-2-to-3">Upgrading from version 2 to 3</h4> <p>In this new major release which supports the new MongoDB PHP extension, we also moved the location of the Model class and replaced the MySQL model class with a trait.</p> <p>Please change all <code>Jenssegers\Mongodb\Model</code> references to <code>Jenssegers\Mongodb\Eloquent\Model</code> either at the top of your model files or your registered alias.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If you are using hybrid relations, your MySQL classes should now extend the original Eloquent model class <code>Illuminate\Database\Eloquent\Model</code> instead of the removed <code>Jenssegers\Eloquent\Model</code>.</p> <p>Instead use the new <code>Jenssegers\Mongodb\Eloquent\HybridRelations</code> trait. This should make things more clear as there is only one single model class in this package.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Jenssegers<span class="token punctuation">\</span>Mongodb<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>HybridRelations</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>

    <span class="token keyword">use</span> <span class="token package">HybridRelations</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'mysql'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Embedded relations now return an <code>Illuminate\Database\Eloquent\Collection</code> rather than a custom Collection class. If you were using one of the special methods that were available, convert them to Collection operations.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$books</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">books</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">sortBy</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'title'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="security-contact-information">Security contact information</h2> <p>To report a security vulnerability, follow <a href="https://tidelift.com/security" target="_blank" rel="noopener noreferrer">these steps<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div></div> <!----></div></div> <footer class="footer flex-none"><div class="container mx-auto h-full flex items-center justify-center"><a href="https://github.com/Ace520">Github</a> · Powered by VuePress
    </div></footer></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.8b9b2d3a.js" defer></script><script src="/blog/assets/js/4.156a5de0.js" defer></script><script src="/blog/assets/js/21.c3e0a280.js" defer></script>
  </body>
</html>
